<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <title>benchmark</title>
  </head>
  <body>
    <pre id="output"></pre>
    <script type="module">
      async function fetchScript (url) {
        return fetch(url)
          .then(response => response.text())
          .then(text => text.replace(/\bimport\s+Pianolizer\b[^\n]+/gs, '')) // hackity-hack
      }

      async function benchmark (library) {
        const modules = await Promise.all([
          fetchScript(library),
          fetchScript('js/benchmark.js')
        ])
        const blob = new Blob(modules, { type: 'application/javascript' })
        const worker = new Worker(URL.createObjectURL(blob), { type: 'module' })
        return new Promise(resolve => {
          worker.onmessage = e => resolve(e.data)
        })
      }

      async function main () {
        const output = document.getElementById('output')
        output.innerText = window.navigator.userAgent
        output.innerText += '\ntesting Pure JS...\n'
        output.innerText += await benchmark('js/pianolizer.js')
        output.innerText += '\ntesting WASM...\n'
        output.innerText += await benchmark('js/pianolizer-wasm.js')
        output.innerText += '\nfinished!'
      }

      main()
    </script>
  </body>
</html>