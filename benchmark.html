<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <title>benchmark</title>
  </head>
  <body>
    <script type="module">
      // import('./js/benchmark.js')

      async function loader () {
        const fetchText = url => fetch(url).then(response => response.text())
        const pianolizerImplementation = window.location.search.toLowerCase() === '?wasm'
          ? 'js/pianolizer-wasm.js'
          : 'js/pianolizer.js'
        const modules = await Promise.all([
          fetchText(pianolizerImplementation),
          fetchText('js/benchmark.js')
        ])
        const patchedModules = modules.map(
          str => str.replace(/\b(export\b|import\s+\{.+?\n)/gs, '') // hackity-hack
        )
        const blob = new Blob(patchedModules, { type: 'application/javascript' })

        return new Worker(URL.createObjectURL(blob))
      }

      loader()
    </script>
  </body>
</html>